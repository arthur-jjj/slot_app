<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ‘ãƒãƒ­ãƒ¼ã‚°</title>
  <style>
    body {
      font-family: sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #header {
      width: 100%;
      display: flex;
      justify-content: flex-end;
      padding: 10px;
      background: black;
    }

    #menuButton {
      padding: 6px 12px;
      border: 2px solid black;
      border-radius: 12px;
      background: white;
      font-weight: bold;
      cursor: pointer;
    }

    #section {
      width: 90%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    #topBoxes {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .box {
      border: 2px solid black;
      border-radius: 20px;
      background: white;
      height: 300px;
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
    }

    .box-1 {
    width: 100px;              /* â† å¹…ã‚’å›ºå®š */
    height: 250px;              /* â† é«˜ã•ã‚‚å›ºå®š */
    font-size: 0.9rem;
    border: 2px solid black;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;       /* â† æŠ˜ã‚Šè¿”ã—ç¦æ­¢ */
    overflow: hidden;          /* â† ã¯ã¿å‡ºã—é˜²æ­¢ */
    text-overflow: ellipsis;   /* â† é•·æ–‡çœç•¥å¯ */
    }

    .reel-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }
      

    #wideBox {
    width: 240px;              /* â† å¹…ã‚’å›ºå®š */
    height: 40px;              /* â† é«˜ã•ã‚‚å›ºå®š */
    font-size: 0.9rem;
    border: 2px solid black;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;       /* â† æŠ˜ã‚Šè¿”ã—ç¦æ­¢ */
    overflow: hidden;          /* â† ã¯ã¿å‡ºã—é˜²æ­¢ */
    text-overflow: ellipsis;   /* â† é•·æ–‡çœç•¥å¯ */
    }

    #bottomArea {
      display: flex;
      width: 100%;
      justify-content: space-between;
      align-items: flex-start;
      margin-top: 10px;
    }

    #leftSide {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    #leverButton {
      background: #ff3333;
      border-radius: 50%;
      width: 30px;
      height: 100px;
    }

    #reelArea {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }


    #reels {
    display: flex;
    flex-direction: row;  /* æ¨ªä¸¦ã³ */
    gap: 16px;
    justify-content: center;
    align-items: center;
    margin-left: 34px;  
  }

    #reels > div {
    width: 64px;
    height: 64px;
    border: 1px solid black;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
  }

    #stopButtons {
      display: flex;
      gap: 10px;
    }

    button.stop-button {
      border: 2px solid black;
      background: white;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 1rem;
    }

    #infoArea {
      margin-top: 30px;
      background: #fff;
      padding: 10px;
      font-size: 1rem;
      border-top: 2px solid #ccc;
      text-align: center;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="header">
    <div id="menuButton" onclick="alert('MENUæ©Ÿèƒ½ã¯ä»Šå¾Œè¿½åŠ äºˆå®šã§ã™')">MENU</div>
  </div>

  <div id="section">
    <div id="topBoxes">
      <div class="box">æ¼”å‡ºç”»é¢</div>
    </div>

    <div id="bottomArea">
      <div id="leftSide">
        <div class="box-1">ãƒãƒ‹ãƒ¼ã‚¬ãƒ¼ãƒ«</div>
      </div>
      <div id="reelArea">
        <div id="wideBox">ãƒãƒ«ãƒ1</div>
          <div id="reels">
            <div id="reel1"></div>
            <div id="reel2"></div>
            <div id="reel3"></div>
        </div>
      <div id="stopButtons">
        <!-- ãƒ¬ãƒãƒ¼ -->
        <div id="leverButton" onclick="pullLever()"></div>

        <!-- åœæ­¢ãƒœã‚¿ãƒ³ -->
        <button class="stop-button" onclick="stopReel(0)">å·¦åœæ­¢</button>
        <button class="stop-button" onclick="stopReel(1)">ä¸­åœæ­¢</button>
        <button class="stop-button" onclick="stopReel(2)">å³åœæ­¢</button>
        </div>
      </div>
    </div>
  </div>

  <div id="infoArea">
    ã‚³ã‚¤ãƒ³ï¼š<span id="coin">50</span>ã€€è¨­å®šï¼š<span id="setting">1</span>ã€€çµŒé¨“å€¤ï¼š<span id="exp">0</span>ï¼ˆæ¬¡ã®è¨­å®šã¾ã§ï¼š<span id="nextExp">2</span>ï¼‰ã€€å›è»¢æ•°ï¼š<span id="spinCount">0</span>
    ã‚¹ãƒ†ãƒ¼ã‚¸ç›®æ¨™ï¼š<span id="stageGoal">10000</span>  
    <div id="milestoneStatus"></div>
  <div id="relicSelection"></div>
    <div id="log"></div>
  </div>
  
<script>
 let relicCherryExp2 = false;
    let relicGrape10 = false;
    let relicReplay3 = false;

    // ãƒ¬ãƒªãƒƒã‚¯å€™è£œ
    const relics = [
    {
        name: 'ãƒã‚§ãƒªãƒ¼ã®ç²å¾—çµŒé¨“å€¤ãŒ2ã«ãªã‚‹',
        effect: () => { relicCherryExp2 = true; }
    },
    {
        name: 'ãƒ–ãƒ‰ã‚¦ã®ç²å¾—æšæ•°10æšã«ãªã‚‹',
        effect: () => { relicGrape10 = true; }
    },
    {
        name: 'ãƒªãƒ—ãƒ¬ã‚¤ã«+3æšã®æ‰•ã„å‡ºã—',
        effect: () => { relicReplay3 = true; }
    }
    ];

    let coin = 50;
    let exp = 0;
    let setting = 1;
    let stageGoal = 10000;
    let spinCount = 0;
    const milestones = [
      { spins: 100, score: 1, cleared: false },
      { spins: 300, score: 1000, cleared: false },
      { spins: 500, score: 5000, cleared: false },
    ];
    const logHistory = [];
    let previousReplay = false;
    let currentOutcome = null;
    let stopped = [true, true, true];
    let reelResults = ["", "", ""];
    const symbols = ['ãƒªãƒ—ãƒ¬ã‚¤', 'ãƒã‚§ãƒªãƒ¼', 'ãƒ–ãƒ‰ã‚¦', 'ãƒ”ã‚¨ãƒ­', 'ãƒ™ãƒ«', '7', 'BAR', 'é‡‘7'];

    const probabilityTable = {
        1: [
            { name: 'ãƒã‚ºãƒ¬', rate: 500, payout: 0 },
            { name: 'ãƒªãƒ—ãƒ¬ã‚¤', rate: 100, payout: 0, replay: true },
            { name: 'ãƒã‚§ãƒªãƒ¼', rate: 28, payout: 1, exp: 1 },
            { name: 'ãƒ–ãƒ‰ã‚¦', rate: 100, payout: 7 },
            { name: 'ãƒ”ã‚¨ãƒ­', rate: 1, payout: 10 },
            { name: 'ãƒ™ãƒ«', rate: 1, payout: 15 },
            { name: '7+7+BAR', rate: 3, payout: 104 },
            { name: '777', rate: 2, payout: 312 },
            { name: 'é‡‘7+é‡‘7+é‡‘7', rate: 1, payout: 312, bonus: true }
        ],
        2: [
            { name: 'ãƒã‚ºãƒ¬', rate: 480, payout: 0 },
            { name: 'ãƒªãƒ—ãƒ¬ã‚¤', rate: 100, payout: 0, replay: true },
            { name: 'ãƒã‚§ãƒªãƒ¼', rate: 30, payout: 1, exp: 1 },
            { name: 'ãƒ–ãƒ‰ã‚¦', rate: 100, payout: 7 },
            { name: 'ãƒ”ã‚¨ãƒ­', rate: 1, payout: 10 },
            { name: 'ãƒ™ãƒ«', rate: 1, payout: 15 },
            { name: '7+7+BAR', rate: 5, payout: 104 },
            { name: '777', rate: 3, payout: 312 },
            { name: 'é‡‘7+é‡‘7+é‡‘7', rate: 1, payout: 312, bonus: true }
        ],
        3: [
            { name: 'ãƒã‚ºãƒ¬', rate: 450, payout: 0 },
            { name: 'ãƒªãƒ—ãƒ¬ã‚¤', rate: 100, payout: 0, replay: true },
            { name: 'ãƒã‚§ãƒªãƒ¼', rate: 32, payout: 1, exp: 1 },
            { name: 'ãƒ–ãƒ‰ã‚¦', rate: 100, payout: 7 },
            { name: 'ãƒ”ã‚¨ãƒ­', rate: 2, payout: 10 },
            { name: 'ãƒ™ãƒ«', rate: 2, payout: 15 },
            { name: '7+7+BAR', rate: 6, payout: 104 },
            { name: '777', rate: 4, payout: 312 },
            { name: 'é‡‘7+é‡‘7+é‡‘7', rate: 2, payout: 312, bonus: true }
        ],
        4: [
            { name: 'ãƒã‚ºãƒ¬', rate: 430, payout: 0 },
            { name: 'ãƒªãƒ—ãƒ¬ã‚¤', rate: 100, payout: 0, replay: true },
            { name: 'ãƒã‚§ãƒªãƒ¼', rate: 34, payout: 1, exp: 1 },
            { name: 'ãƒ–ãƒ‰ã‚¦', rate: 100, payout: 7 },
            { name: 'ãƒ”ã‚¨ãƒ­', rate: 3, payout: 10 },
            { name: 'ãƒ™ãƒ«', rate: 3, payout: 15 },
            { name: '7+7+BAR', rate: 7, payout: 104 },
            { name: '777', rate: 5, payout: 312 },
            { name: 'é‡‘7+é‡‘7+é‡‘7', rate: 2, payout: 312, bonus: true }
        ],
        5: [
            { name: 'ãƒã‚ºãƒ¬', rate: 400, payout: 0 },
            { name: 'ãƒªãƒ—ãƒ¬ã‚¤', rate: 100, payout: 0, replay: true },
            { name: 'ãƒã‚§ãƒªãƒ¼', rate: 36, payout: 1, exp: 1 },
            { name: 'ãƒ–ãƒ‰ã‚¦', rate: 100, payout: 7 },
            { name: 'ãƒ”ã‚¨ãƒ­', rate: 4, payout: 10 },
            { name: 'ãƒ™ãƒ«', rate: 4, payout: 15 },
            { name: '7+7+BAR', rate: 8, payout: 104 },
            { name: '777', rate: 6, payout: 312 },
            { name: 'é‡‘7+é‡‘7+é‡‘7', rate: 3, payout: 312, bonus: true }
        ],
        6: [
            { name: 'ãƒã‚ºãƒ¬', rate: 380, payout: 0 },
            { name: 'ãƒªãƒ—ãƒ¬ã‚¤', rate: 100, payout: 0, replay: true },
            { name: 'ãƒã‚§ãƒªãƒ¼', rate: 38, payout: 1, exp: 1 },
            { name: 'ãƒ–ãƒ‰ã‚¦', rate: 100, payout: 7 },
            { name: 'ãƒ”ã‚¨ãƒ­', rate: 5, payout: 10 },
            { name: 'ãƒ™ãƒ«', rate: 5, payout: 15 },
            { name: '7+7+BAR', rate: 9, payout: 104 },
            { name: '777', rate: 7, payout: 312 },
            { name: 'é‡‘7+é‡‘7+é‡‘7', rate: 3, payout: 312, bonus: true }
        ]
        };

    function pullLever() {
      if (stopped.includes(false)) {
        logMessage("å‰ã®ã‚¹ãƒ”ãƒ³ãŒçµ‚ã‚ã£ã¦ã„ã¾ã›ã‚“ï¼");
        return;
      }
      if (!previousReplay && coin < 3) {
        logMessage("ã‚³ã‚¤ãƒ³ä¸è¶³ã§ã™ï¼");
        return;
      }
      if (!previousReplay) coin -= 3;
      previousReplay = false;
      spinCount++;
      currentOutcome = draw();
      stopped = [false, false, false];
      const outcomeName = currentOutcome.name;
      if (outcomeName === '7+7+BAR') {
        reelResults = ['7', '7', 'BAR'];
      } else if (outcomeName === 'é‡‘7+é‡‘7+é‡‘7') {
        reelResults = ['é‡‘7', 'é‡‘7', 'é‡‘7'];
      } else if (outcomeName === '777') {
        reelResults = ['7', '7', '7'];
      } else if (outcomeName.includes('+')) {
        const parts = outcomeName.split('+');
        reelResults = [parts[0], parts[1], parts[2]];
      } else if (symbols.includes(outcomeName)) {
        reelResults = [outcomeName, outcomeName, outcomeName];
      } else {
        reelResults = generateMiss();
      }
      updateDisplay();
    }

    function stopReel(index) {
      if (stopped[index]) return;
      stopped[index] = true;
      if (stopped.every(s => s)) evaluateOutcome();
      updateDisplay();  // â† å¿µã®ãŸã‚ã“ã“ã§å†è¡¨ç¤ºã—ã¦OK
    }

    function evaluateOutcome() {
      if (!currentOutcome) return;
        // ğŸ’¡ãƒ¬ãƒªãƒƒã‚¯åŠ¹æœã‚’ã“ã“ã§åæ˜ 
        if (currentOutcome.name === 'ãƒã‚§ãƒªãƒ¼' && relicCherryExp2) {
            currentOutcome.exp = 2;
        }
        if (currentOutcome.name === 'ãƒ–ãƒ‰ã‚¦' && relicGrape10) {
            currentOutcome.payout = 10;
        }
        if (currentOutcome.name === 'ãƒªãƒ—ãƒ¬ã‚¤' && relicReplay3) {
            currentOutcome.payout = 3;
        }
      const resultName = currentOutcome.name;
      const payout = currentOutcome.payout || 0;
      if (currentOutcome.exp) exp += currentOutcome.exp;
      if (currentOutcome.replay) {
        previousReplay = true;
        }
        coin += payout;  // ãƒªãƒ—ãƒ¬ã‚¤ã§ã‚‚ payout ãŒã‚ã‚‹ãªã‚‰åŠ ç®—ã™ã‚‹
      coin += payout;
      if (exp >= 20) setting = 6;
      else if (exp >= 15) setting = 5;
      else if (exp >= 10) setting = 4;
      else if (exp >= 5) setting = 3;
      else if (exp >= 2) setting = 2;
      else setting = 1;
      logMessage(`â–¶ ${resultName}ï¼${payout > 0 ? ` +${payout}æš` : currentOutcome.replay ? `ãƒªãƒ—ãƒ¬ã‚¤ï¼` : `ãƒã‚ºãƒ¬â€¦`}`);
      currentOutcome = null;
      updateDisplay();
      checkMilestones();
    }

    function showRelicChoices() {
      const container = document.getElementById('relicSelection');
      container.innerHTML = '<p>ãƒ¬ãƒªãƒƒã‚¯ã‚¹ã‚­ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„ï¼š</p>';
      const choices = relics.sort(() => 0.5 - Math.random()).slice(0, 3);
      choices.forEach((relic) => {
        const div = document.createElement('div');
        div.className = 'relic-option';
        div.textContent = relic.name;
        div.onclick = () => {
          relic.effect();
          logMessage(`ğŸ§¿ ${relic.name} ã‚’ç²å¾—ï¼`);
          container.style.display = 'none';
        };
        container.appendChild(div);
      });
      container.style.display = 'block';
    }

     function checkMilestones() {
      if (coin >= stageGoal) {
        logMessage("ğŸ‰ ãƒãƒ«ãƒé”æˆï¼ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼");
      }
      milestones.forEach((m, i) => {
        if (!m.cleared && spinCount <= m.spins && coin >= m.score) {
          logMessage(`âœ¨ ä¸­é–“ãƒãƒ«ãƒ${i+1}é”æˆï¼ãƒ¬ãƒªãƒƒã‚¯ã‚¹ã‚­ãƒ«å€™è£œè¡¨ç¤ºï¼`);
          m.cleared = true;
          showRelicChoices();
        } else if (!m.cleared && spinCount > m.spins) {
          logMessage(`ğŸ’€ ä¸­é–“ãƒãƒ«ãƒ${i+1}æœªé”æˆâ€¦`);
          m.cleared = true;
        }
      });
      if (coin <= 2) {
        logMessage("ğŸ’€ ã‚³ã‚¤ãƒ³æ®‹ã‚Š2æšä»¥ä¸‹ï¼GAME OVER");
      }
      updateMilestoneDisplay();
    }



    function draw() {
      const table = probabilityTable[setting];
      const total = table.reduce((sum, item) => sum + item.rate, 0);
      let rand = Math.random() * total;
      for (let item of table) {
        if ((rand -= item.rate) < 0) return item;
      }
      return table[0];
    }

    function generateMiss() {
      let result = [];
      while (result.length < 3) {
        const rand = symbols[Math.floor(Math.random() * symbols.length)];
        if (!result.includes(rand)) result.push(rand);
      }
      return result;
    }

    function getImageForSymbol(symbol) {
  const map = {
    'ãƒªãƒ—ãƒ¬ã‚¤': 'reply.png',
    'ãƒã‚§ãƒªãƒ¼': 'cherry.png',
    'ãƒ–ãƒ‰ã‚¦': 'grape.png',
    'ãƒ”ã‚¨ãƒ­': 'joker.png',
    'ãƒ™ãƒ«': 'bell.png',
    '7': 'seven.png',
    'BAR': 'bar.png',
    'é‡‘7': 'gold7.png'
  };
  const filename = map[symbol];
  if (!filename) return `<div style="width:64px;height:64px;"></div>`;  // ä¸‡ä¸€æœªå®šç¾©ã§ã‚‚ç©º
  return `<img src="img/${filename}" class="reel-image" alt="">`;
}

    
    function updateDisplay() {
      document.getElementById("coin").textContent = coin;
      document.getElementById("exp").textContent = exp;
      document.getElementById("setting").textContent = setting;
      document.getElementById("nextExp").textContent = nextExpText();
      document.getElementById("coin").textContent = coin;
      document.getElementById("stageGoal").textContent = stageGoal;
      document.getElementById("spinCount").textContent = spinCount;
      for (let i = 0; i < 3; i++) {
        const reelElem = document.getElementById(`reel${i + 1}`);
        const content = stopped[i] ? getImageForSymbol(reelResults[i]) : "â“";
        reelElem.innerHTML = content;
      }
    }

    function logMessage(msg) {
      logHistory.unshift(msg);
      document.getElementById("log").innerHTML = logHistory
        .slice(0, 10)
        .map(x => `<div style='padding: 5px; border-bottom: 1px solid #ddd;'>${x}</div>`)
        .join('');
    }

    function updateMilestoneDisplay() {
      const html = milestones.map((m, i) => `ãƒãƒ«ãƒ${i+1}: ${m.spins}å›è»¢ä»¥å†…ã«${m.score}æš - ${m.cleared ? 'æ¸ˆ' : 'æœªé”'}`).join("<br>");
      document.getElementById("milestoneStatus").innerHTML = html;
    }

    function nextExpText() {
      const table = {1: 2, 2: 5, 3: 10, 4: 15, 5: 20};
      return table[setting] ? `${table[setting] - exp} çµŒé¨“å€¤` : 'MAX';
    }

    updateDisplay();
    updateMilestoneDisplay(); 
</script>
</body>
</html>
